# 토스 페이먼츠 설정 가이드

## 1. 토스 페이먼츠 계정 생성

1. [토스 페이먼츠 개발자 센터](https://developers.tosspayments.com/)에 접속
2. 회원가입 및 로그인
3. 새 애플리케이션 생성

## 2. API 키 발급

### 개발용 (테스트) 키
- **클라이언트 키**: `test_ck_*` 형태
- **시크릿 키**: `test_sk_*` 형태

### 운영용 (실제) 키
- **클라이언트 키**: `live_ck_*` 형태  
- **시크릿 키**: `live_sk_*` 형태

## 3. 환경 변수 설정

`.env.local` 파일에 다음 환경 변수를 추가하세요:

```bash
# 토스 페이먼츠 설정
NEXT_PUBLIC_TOSS_CLIENT_KEY=test_ck_your_client_key_here
TOSS_SECRET_KEY=test_sk_your_secret_key_here

# 기본 URL (배포 시 실제 도메인으로 변경)
NEXT_PUBLIC_BASE_URL=http://localhost:3000
```

## 4. 데이터베이스 테이블 생성

Supabase SQL 에디터에서 다음 스크립트를 실행하세요:

```sql
-- create-ebook-purchases-table.sql 파일 내용 실행
```

## 5. 결제 테스트

### 테스트 카드 정보
- **카드번호**: 4242424242424242
- **유효기간**: 12/25 (미래 날짜)
- **CVC**: 123
- **비밀번호**: 1234

### 테스트 시나리오
1. 유료 전자책 상세 페이지 접속
2. "구매하기" 버튼 클릭
3. 테스트 카드 정보로 결제 진행
4. 결제 성공 후 다운로드 가능 확인

## 6. 운영 배포 시 주의사항

1. **환경 변수 변경**:
   - `NEXT_PUBLIC_TOSS_CLIENT_KEY`: 실제 클라이언트 키로 변경
   - `TOSS_SECRET_KEY`: 실제 시크릿 키로 변경
   - `NEXT_PUBLIC_BASE_URL`: 실제 도메인으로 변경

2. **웹훅 설정** (선택사항):
   - 토스 페이먼츠 대시보드에서 웹훅 URL 설정
   - 결제 상태 변경 시 자동 알림 수신

3. **보안 설정**:
   - 시크릿 키는 절대 클라이언트에 노출되지 않도록 주의
   - HTTPS 사용 필수

## 7. 문제 해결

### 자주 발생하는 오류

1. **"결제 시스템을 로드하는 중입니다"**
   - 토스 페이먼츠 SDK 로딩 실패
   - 네트워크 연결 확인 또는 페이지 새로고침

2. **"결제 요청에 실패했습니다"**
   - 환경 변수 설정 확인
   - 데이터베이스 테이블 존재 여부 확인

3. **"구매하지 않은 전자책입니다"**
   - 결제 완료 후 구매 내역이 정상적으로 저장되지 않음
   - 데이터베이스 RLS 정책 확인

## 8. 지원 및 문의

- [토스 페이먼츠 개발자 문서](https://docs.tosspayments.com/)
- [토스 페이먼츠 고객센터](https://support.tosspayments.com/)
